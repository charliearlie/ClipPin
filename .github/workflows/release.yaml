# .github/workflows/release.yml
#
# Automatically builds and releases ClipPin when you push a version tag.
#
# Usage:
#   git tag v1.2.0
#   git push origin v1.2.0
#
# This will create a GitHub Release with ClipPin-v1.2.0.zip attached.

name: Release

on:
  push:
    tags:
      - 'v*'  # Triggers on v1.0.0, v1.2.3, etc.

jobs:
  build:
    runs-on: macos-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Extract version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: Build app
        run: |
          chmod +x package_app.sh
          ./package_app.sh ${{ steps.version.outputs.VERSION }}

      - name: Verify build
        run: |
          if [ ! -f "ClipPin-v${{ steps.version.outputs.VERSION }}.zip" ]; then
            echo "Build failed - zip file not found"
            exit 1
          fi
          ls -la ClipPin-v${{ steps.version.outputs.VERSION }}.zip

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: ClipPin v${{ steps.version.outputs.VERSION }}
          draft: false
          prerelease: false
          files: ClipPin-v${{ steps.version.outputs.VERSION }}.zip
          body: |
            ## Installation
            
            1. Download `ClipPin-v${{ steps.version.outputs.VERSION }}.zip` below
            2. Unzip and move `ClipPin.app` to Applications
            3. Right-click â†’ Open (first launch only)
            
            ## Requirements
            
            - macOS 13.0 or later
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}